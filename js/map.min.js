/*!
 * Start Bootstrap - Agency v3.3.7+1 (http://startbootstrap.com/template-overviews/agency)
 * Copyright 2013-2018 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
$(function(){function t(){f=L.map("map",{scrollWheelZoom:!1,dragging:!1,tap:!1}).setView([46.778626,6.641014],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(f)}function e(){var t=L.Control.extend({options:{position:"topleft"},onAdd:function(t){var e=$('<div class="leaflet-bar leaflet-control leaflet-custom-control"></div>'),n=$('<a href="#" title="Retour au sentier" role="button" aria-label="Retour au sentier"></a>').appendTo(e);$('<span class="glyphicon glyphicon-map-marker"></span>').appendTo(n);return n.on("click",function(e){e.preventDefault(),t.fitBounds(m,d({animate:!0,duration:.5}))}),e[0]}});f.addControl(new t)}function n(){return $.when($.ajax({url:"/api/trails/"+h+"?include=geometry"}),$.ajax({url:"/api/trails/"+h+"/zones",dataType:"json"}))}function o(t,e){return y=t[0],$.when([r(t[0]),a(e[0],t[0])])}function r(t){L.geoJSON(s([t]),{style:function(t){return{color:"#ff00bb"}}}).addTo(f)}function a(t,n){var o,r,a,p,l,g;if(_.each(t,function(t){var e=t.geometry.coordinates[0];_.each(e,function(t){r=Math.min(t[0],r||180),o=Math.min(t[1],o||90),p=Math.max(t[0],p||-180),a=Math.max(t[1],a||-90)}),l=!l||i(t,n)<i(l,n)?t:l,g=!g||i(t,n)>i(g,n)?t:g}),void 0!==o&&void 0!==r&&void 0!==a&&void 0!==p){var y=L.latLng(a,p),h=L.latLng(o,r);if(m=L.latLngBounds(h,y),f.fitBounds(m,d()),e(),L.geoJSON(s(t),{onEachFeature:function(t,e){return c(t,e,n)},style:u()}).bindTooltip(function(t){return t.feature.properties.type}).addTo(f),"Point"===_.get(l,"points.start.geometry.type")){var v=l.points.start;L.marker(L.latLng(v.geometry.coordinates[1],v.geometry.coordinates[0])).addTo(f)}if("Point"===_.get(g,"points.end.geometry.type")){var $=g.points.end;L.marker(L.latLng($.geometry.coordinates[1],$.geometry.coordinates[0])).addTo(f)}}}function i(t,e){return t.trailHrefs[e.href].position}function u(t,e){var n="#3388ff",o=.2,r=t&&t.properties.highlighted,a=g&&t===g;return a&&r?(n="#00c000",o=.4):a?(n="#008b00",o=.4):r&&(n="#0000ff",o=.4),{color:n,fillOpacity:o}}function c(t,e,n){t.updateLayerStyle=function(){e.setStyle(u(t))},e.on("click",function(){var e=g;g&&g===t?(g=void 0,l(g)):(g=t,p(g,n)),t.updateLayerStyle(),e&&e.updateLayerStyle()}),e.on("mouseout",function(){t.properties.highlighted=!1,t.updateLayerStyle()}),e.on("mouseover",function(){t.properties.highlighted=!0,t.updateLayerStyle()})}function p(t){b.addClass("active"),$("h2",v).text(t.properties.type),$("p",v).text(t.properties.description),$("span.zone-number",v).text(i(t.properties,y))}function l(){}function s(t){return{type:"FeatureCollection",features:t.map(function(t){return{type:"Feature",geometry:t.geometry,properties:_.omit(t,"geometry")}})}}function d(t){return t=t||{},t.padding=t.padding||[20,20],t}var f,g,y,m,h="8c8c2474-4375-4121-95d3-763f381717df",v=$("#zone-sheet"),b=$("div.backdrop",$("#map"));b.click(function(t){t.target===this&&$(this).removeClass("active")}),$("button.close",v).click(function(){b.removeClass("active")}),$.when().then(t).then(n).then(o)});